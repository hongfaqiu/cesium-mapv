!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("cesium")):"function"==typeof define&&define.amd?define(["exports","cesium"],e):e(t.mapv=t.mapv||{},t.cesium)}(this,function(t,e){"use strict";function n(){this._subscribers={}}function i(t){var e=t.split("|");return e[0]=e[0].split(","),{lng:parseFloat(e[0][0]),lat:parseFloat(e[0][1])}}function r(t,e){n.bind(this)(),this._options=e||{},this._data=[],t&&this.add(t)}function o(t,e){if("undefined"==typeof document);else{var n=document.createElement("canvas");t&&(n.width=t),e&&(n.height=e)}return n}function a(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=t.maxSize||35,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}function s(t){this.splitList=t||{other:1}}function l(t){this.splitList=t||[{start:0,value:"red"}]}function h(t,e,n){var i=60*n+30,r=Math.PI/180*i;return[t.x+e*Math.cos(r),t.y+e*Math.sin(r)]}function u(t,e,n){var i=g(n),r=c(n),o=i-r,a=0,s=1024;(f=n.range||null)&&2===f.length&&(a=(f[0]-r)/o*1024),f&&2===f.length&&(s=(f[1]-r)/o*1024);for(var l,h=n.maxOpacity||.8,u=n.minOpacity||0,f=n.range,v=3,p=t.length;v<p;v+=4)l=4*t[v],t[v]/256>h&&(t[v]=256*h),t[v]/256<u&&(t[v]=256*u),l&&l>=a&&l<=s?(t[v-3]=e[l],t[v-2]=e[l+1],t[v-1]=e[l+2]):t[v]=0}function g(t){return t.max||100}function c(t){return t.min||0}function f(t,e,n){var i=g(n),r=c(n),s=n._size;void 0==s&&void 0==(s=n.size)&&(s=13);var l=new a({gradient:n.gradient,max:i,min:r}),h=function(t){var e=t/2,n=t+e,i=new o(2*n,2*n),r=i.getContext("2d");return r.shadowBlur=e,r.shadowColor="black",r.shadowOffsetX=r.shadowOffsetY=1e4,r.beginPath(),r.arc(n-1e4,n-1e4,t,0,2*Math.PI,!0),r.closePath(),r.fill(),i}(s),u=h.width/2,f=h.height/2,v={};e.forEach(function(t,e){var n=void 0===t.count?1:t.count,r=Math.min(1,n/i).toFixed(2);v[r]=v[r]||[],v[r].push(t)});for(var p in v)if(!isNaN(p)){var d=v[p];t.beginPath(),n.withoutAlpha||(t.globalAlpha=p),t.strokeStyle=l.getColor(p*i),d.forEach(function(e,r){if(e.geometry){var o=e.geometry._coordinates||e.geometry.coordinates,a=e.geometry.type;if("Point"===a){s=void 0===e.count?1:e.count;t.globalAlpha=s/i,t.drawImage(h,o[0]-u,o[1]-f)}else if("LineString"===a){var s=void 0===e.count?1:e.count;t.globalAlpha=s/i,t.beginPath(),rt.draw(t,e,n),t.stroke()}}})}}function v(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=360*Math.atan(i/n)/(2*Math.PI);return e[0]<t[0]&&(r+=180),r}function p(t,e,n){var i=t.createShader(n);return t.shaderSource(i,e),t.compileShader(i),i}function d(t,e,n){var i=p(t,e,t.VERTEX_SHADER),r=p(t,n,t.FRAGMENT_SHADER),o=t.createProgram();return t.attachShader(o,i),t.attachShader(o,r),t.linkProgram(o),t.useProgram(o),o}function y(t){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=1,e.height=1,n.fillStyle=t,n.fillRect(0,0,1,1),n.getImageData(0,0,1,1).data}function m(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,o=x(t,0,r,n,!0),a=[];if(!o)return a;var s,l,h,u,g,c,f;if(i&&(o=function(t,e,n,i){var r,o,a,s,l,h=[];for(r=0,o=e.length;r<o;r++)a=e[r]*i,s=r<o-1?e[r+1]*i:t.length,(l=x(t,a,s,i,!1))===l.next&&(l.steiner=!0),h.push(function(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}(l));for(h.sort(_),r=0;r<h.length;r++)!function(t,e){if(e=function(t,e){var n,i=e,r=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n.prev;var l,h=n,u=n.x,g=n.y,c=1/0;for(i=n.next;i!==h;)r>=i.x&&i.x>=u&&P(o<g?r:a,o,u,g,o<g?a:r,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(r-i.x))<c||l===c&&i.x>n.x)&&C(i,t)&&(n=i,c=l),i=i.next;return n}(t,e)){var n=I(e,t);w(n,n.next)}}(h[r],n),n=w(n,n.next);return n}(t,e,o,n)),t.length>80*n){s=h=t[0],l=u=t[1];for(var v=n;v<r;v+=n)g=t[v],c=t[v+1],g<s&&(s=g),c<l&&(l=c),g>h&&(h=g),c>u&&(u=c);f=Math.max(h-s,u-l)}return b(o,a,n,s,l,f),a}function x(t,e,n,i,r){var o,a;if(r===D(t,e,n,i)>0)for(o=e;o<n;o+=i)a=L(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=L(o,t[o],t[o+1],a);return a&&k(a,a.next)&&(A(a),a=a.next),a}function w(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!k(i,i.next)&&0!==M(i.prev,i,i.next))i=i.next;else{if(A(i),(i=e=i.prev)===i.next)return null;n=!0}}while(n||i!==e);return e}function b(t,e,n,i,r,o,a){if(t){!a&&o&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=S(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,a,s,l,h=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,i=n,s=0,e=0;e<h&&(s++,i=i.nextZ);e++);for(l=h;s>0||l>0&&i;)0===s?(r=i,i=i.nextZ,l--):0!==l&&i?n.z<=i.z?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--):(r=n,n=n.nextZ,s--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,h*=2}while(a>1)}(r)}(t,i,r,o);for(var s,l,h=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?function(t,e,n,i){var r=t.prev,o=t,a=t.next;if(M(r,o,a)>=0)return!1;var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,h=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,u=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,g=S(s,l,e,n,i),c=S(h,u,e,n,i),f=t.nextZ;for(;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&P(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&M(f.prev,f,f.next)>=0)return!1;f=f.nextZ}f=t.prevZ;for(;f&&f.z>=g;){if(f!==t.prev&&f!==t.next&&P(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&M(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}(t,i,r,o):function(t){var e=t.prev,n=t,i=t.next;if(M(e,n,i)>=0)return!1;var r=t.next.next;for(;r!==t.prev;){if(P(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&M(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}(t))e.push(s.i/n),e.push(t.i/n),e.push(l.i/n),A(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?b(t=function(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!k(r,o)&&E(r,i,i.next,o)&&C(r,o)&&C(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),A(i),A(i.next),i=t=o),i=i.next}while(i!==t);return i}(t,e,n),e,n,i,r,o,2):2===a&&function(t,e,n,i,r,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&E(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&C(t,e)&&C(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}(a,s)){var l=I(a,s);return a=w(a,a.next),l=w(l,l.next),b(a,e,n,i,r,o),void b(l,e,n,i,r,o)}s=s.next}a=a.next}while(a!==t)}(t,e,n,i,r,o):b(w(t),e,n,i,r,o,1);break}}}function _(t,e){return t.x-e.x}function S(t,e,n,i,r){return t=32767*(t-n)/r,e=32767*(e-i)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function P(t,e,n,i,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function M(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function k(t,e){return t.x===e.x&&t.y===e.y}function E(t,e,n,i){return!!(k(t,e)&&k(n,i)||k(t,i)&&k(n,e))||M(t,e,n)>0!=M(t,e,i)>0&&M(n,i,t)>0!=M(n,i,e)>0}function C(t,e){return M(t.prev,t,t.next)<0?M(t,e,t.next)>=0&&M(t,t.prev,e)>=0:M(t,e,t.prev)<0||M(t,t.next,e)<0}function I(t,e){var n=new R(t.i,t.x,t.y),i=new R(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function L(t,e,n,i){var r=new R(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function R(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(t,e,n,i){for(var r=0,o=e,a=n-i;o<n;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}function O(t,e,n){var i=60*n+30,r=Math.PI/180*i;return[t.x+e*Math.cos(r),t.y+e*Math.sin(r)]}function B(t,e){for(var n=0;n<t.length;n++)if(function(t,e){var n=Math.min(t.ne.x,e.ne.x),i=Math.min(t.sw.y,e.sw.y),r=Math.max(t.sw.x,e.sw.x),o=Math.max(t.ne.y,e.ne.y);if(n>r&&i>o)return!0;return!1}(t[n],e))return!0;return!1}function F(t,e,n,i){n.save();var r=i.geometry._coordinates||i.geometry.coordinates,o=r[0],a=r[1],s=e.offset||{x:0,y:0},l=i.width||e._width||e.width,h=i.height||e._height||e.height;if(o=o-~~l/2+s.x,a=a-~~h/2+s.y,"string"==typeof t)return n.beginPath(),n.arc(o,a,e.size||5,0,2*Math.PI),n.fillStyle=e.fillStyle||"red",void n.fill();var u=i.deg||e.deg;u&&(n.translate(o,a),n.rotate(u*Math.PI/180),n.translate(-o,-a)),e.sx&&e.sy&&e.swidth&&e.sheight&&e.width&&e.height?n.drawImage(t,e.sx,e.sy,e.swidth,e.sheight,o,a,l,h):l&&h?n.drawImage(t,o,a,l,h):n.drawImage(t,o,a),n.restore()}function T(t,e,n,i,r,o){if(!(r-i<=n)){var a=i+r>>1;z(t,e,a,i,r,o%2),T(t,e,n,i,a-1,o+1),T(t,e,n,a+1,r,o+1)}}function z(t,e,n,i,r,o){for(;r>i;){if(r-i>600){var a=r-i+1,s=n-i+1,l=Math.log(a),h=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*h*(a-h)/a)*(s-a/2<0?-1:1);z(t,e,n,Math.max(i,Math.floor(n-s*h/a+u)),Math.min(r,Math.floor(n+(a-s)*h/a+u)),o)}var g=e[2*n+o],c=i,f=r;for(Z(t,e,i,n),e[2*r+o]>g&&Z(t,e,i,r);c<f;){for(Z(t,e,c,f),c++,f--;e[2*c+o]<g;)c++;for(;e[2*f+o]>g;)f--}e[2*i+o]===g?Z(t,e,i,f):Z(t,e,++f,r),f<=n&&(i=f+1),n<=f&&(r=f-1)}}function Z(t,e,n,i){U(t,n,i),U(e,2*n,2*i),U(e,2*n+1,2*i+1)}function U(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function N(t,e,n,i){var r=t-n,o=e-i;return r*r+o*o}function j(t){return{type:"Feature",id:t.id,properties:W(t),geometry:{type:"Point",coordinates:[function(t){return 360*(t-.5)}(t.x),function(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(t.y)]}}}function W(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return V(V({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function Y(t){return t/360+.5}function q(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function V(t,e){for(var n in e)t[n]=e[n];return t}function G(t){return t.x}function H(t){return t.y}function J(t){requestAnimationFrame(J),it.update(t)}n.prototype.on=function(t,e){var n=this._subscribers[t];n||(n=[],this._subscribers[t]=n),n.push({callback:e})},n.prototype.off=function(t,e){var n=this._subscribers[t];if(n)for(var i=0;i<n.length;i++)n[i].callback==e&&(n.splice(i,1),i--)},n.prototype._trigger=function(t,e,n){if("*"==t)throw new Error("Cannot trigger event *");var i=[];t in this._subscribers&&(i=i.concat(this._subscribers[t])),"*"in this._subscribers&&(i=i.concat(this._subscribers["*"]));for(var r=0,o=i.length;r<o;r++){var a=i[r];a.callback&&a.callback(t,e,n||null)}};var Q={municipalities:[{n:"北京",g:"116.395645,39.929986|12"},{n:"上海",g:"121.487899,31.249162|12"},{n:"天津",g:"117.210813,39.14393|12"},{n:"重庆",g:"106.530635,29.544606|12"}],provinces:[{n:"安徽",g:"117.216005,31.859252|8",cities:[{n:"合肥",g:"117.282699,31.866942|12"},{n:"安庆",g:"117.058739,30.537898|13"},{n:"蚌埠",g:"117.35708,32.929499|13"},{n:"亳州",g:"115.787928,33.871211|13"},{n:"巢湖",g:"117.88049,31.608733|13"},{n:"池州",g:"117.494477,30.660019|14"},{n:"滁州",g:"118.32457,32.317351|13"},{n:"阜阳",g:"115.820932,32.901211|13"},{n:"淮北",g:"116.791447,33.960023|13"},{n:"淮南",g:"117.018639,32.642812|13"},{n:"黄山",g:"118.29357,29.734435|13"},{n:"六安",g:"116.505253,31.755558|13"},{n:"马鞍山",g:"118.515882,31.688528|13"},{n:"宿州",g:"116.988692,33.636772|13"},{n:"铜陵",g:"117.819429,30.94093|14"},{n:"芜湖",g:"118.384108,31.36602|12"},{n:"宣城",g:"118.752096,30.951642|13"}]},{n:"福建",g:"117.984943,26.050118|8",cities:[{n:"福州",g:"119.330221,26.047125|12"},{n:"龙岩",g:"117.017997,25.078685|13"},{n:"南平",g:"118.181883,26.643626|13"},{n:"宁德",g:"119.542082,26.656527|14"},{n:"莆田",g:"119.077731,25.44845|13"},{n:"泉州",g:"118.600362,24.901652|12"},{n:"三明",g:"117.642194,26.270835|14"},{n:"厦门",g:"118.103886,24.489231|12"},{n:"漳州",g:"117.676205,24.517065|12"}]},{n:"甘肃",g:"102.457625,38.103267|6",cities:[{n:"兰州",g:"103.823305,36.064226|12"},{n:"白银",g:"104.171241,36.546682|13"},{n:"定西",g:"104.626638,35.586056|13"},{n:"甘南州",g:"102.917442,34.992211|14"},{n:"嘉峪关",g:"98.281635,39.802397|13"},{n:"金昌",g:"102.208126,38.516072|13"},{n:"酒泉",g:"98.508415,39.741474|13"},{n:"临夏州",g:"103.215249,35.598514|13"},{n:"陇南",g:"104.934573,33.39448|14"},{n:"平凉",g:"106.688911,35.55011|13"},{n:"庆阳",g:"107.644227,35.726801|13"},{n:"天水",g:"105.736932,34.584319|13"},{n:"武威",g:"102.640147,37.933172|13"},{n:"张掖",g:"100.459892,38.93932|13"}]},{n:"广东",g:"113.394818,23.408004|8",cities:[{n:"广州",g:"113.30765,23.120049|12"},{n:"潮州",g:"116.630076,23.661812|13"},{n:"东莞",g:"113.763434,23.043024|12"},{n:"佛山",g:"113.134026,23.035095|13"},{n:"河源",g:"114.713721,23.757251|12"},{n:"惠州",g:"114.410658,23.11354|12"},{n:"江门",g:"113.078125,22.575117|13"},{n:"揭阳",g:"116.379501,23.547999|13"},{n:"茂名",g:"110.931245,21.668226|13"},{n:"梅州",g:"116.126403,24.304571|13"},{n:"清远",g:"113.040773,23.698469|13"},{n:"汕头",g:"116.72865,23.383908|13"},{n:"汕尾",g:"115.372924,22.778731|14"},{n:"韶关",g:"113.594461,24.80296|13"},{n:"深圳",g:"114.025974,22.546054|12"},{n:"阳江",g:"111.97701,21.871517|14"},{n:"云浮",g:"112.050946,22.937976|13"},{n:"湛江",g:"110.365067,21.257463|13"},{n:"肇庆",g:"112.479653,23.078663|13"},{n:"中山",g:"113.42206,22.545178|12"},{n:"珠海",g:"113.562447,22.256915|13"}]},{n:"广西",g:"108.924274,23.552255|7",cities:[{n:"南宁",g:"108.297234,22.806493|12"},{n:"百色",g:"106.631821,23.901512|13"},{n:"北海",g:"109.122628,21.472718|13"},{n:"崇左",g:"107.357322,22.415455|14"},{n:"防城港",g:"108.351791,21.617398|15"},{n:"桂林",g:"110.26092,25.262901|12"},{n:"贵港",g:"109.613708,23.103373|13"},{n:"河池",g:"108.069948,24.699521|14"},{n:"贺州",g:"111.552594,24.411054|14"},{n:"来宾",g:"109.231817,23.741166|14"},{n:"柳州",g:"109.422402,24.329053|12"},{n:"钦州",g:"108.638798,21.97335|13"},{n:"梧州",g:"111.305472,23.485395|13"},{n:"玉林",g:"110.151676,22.643974|14"}]},{n:"贵州",g:"106.734996,26.902826|8",cities:[{n:"贵阳",g:"106.709177,26.629907|12"},{n:"安顺",g:"105.92827,26.228595|13"},{n:"毕节地区",g:"105.300492,27.302612|14"},{n:"六盘水",g:"104.852087,26.591866|13"},{n:"铜仁地区",g:"109.196161,27.726271|14"},{n:"遵义",g:"106.93126,27.699961|13"},{n:"黔西南州",g:"104.900558,25.095148|11"},{n:"黔东南州",g:"107.985353,26.583992|11"},{n:"黔南州",g:"107.523205,26.264536|11"}]},{n:"海南",g:"109.733755,19.180501|9",cities:[{n:"海口",g:"110.330802,20.022071|13"},{n:"白沙",g:"109.358586,19.216056|12"},{n:"保亭",g:"109.656113,18.597592|12"},{n:"昌江",g:"109.0113,19.222483|12"},{n:"儋州",g:"109.413973,19.571153|13"},{n:"澄迈",g:"109.996736,19.693135|13"},{n:"东方",g:"108.85101,18.998161|13"},{n:"定安",g:"110.32009,19.490991|13"},{n:"琼海",g:"110.414359,19.21483|13"},{n:"琼中",g:"109.861849,19.039771|12"},{n:"乐东",g:"109.062698,18.658614|12"},{n:"临高",g:"109.724101,19.805922|13"},{n:"陵水",g:"109.948661,18.575985|12"},{n:"三亚",g:"109.522771,18.257776|12"},{n:"屯昌",g:"110.063364,19.347749|13"},{n:"万宁",g:"110.292505,18.839886|13"},{n:"文昌",g:"110.780909,19.750947|13"},{n:"五指山",g:"109.51775,18.831306|13"}]},{n:"河北",g:"115.661434,38.61384|7",cities:[{n:"石家庄",g:"114.522082,38.048958|12"},{n:"保定",g:"115.49481,38.886565|13"},{n:"沧州",g:"116.863806,38.297615|13"},{n:"承德",g:"117.933822,40.992521|14"},{n:"邯郸",g:"114.482694,36.609308|13"},{n:"衡水",g:"115.686229,37.746929|13"},{n:"廊坊",g:"116.703602,39.518611|13"},{n:"秦皇岛",g:"119.604368,39.945462|12"},{n:"唐山",g:"118.183451,39.650531|13"},{n:"邢台",g:"114.520487,37.069531|13"},{n:"张家口",g:"114.893782,40.811188|13"}]},{n:"河南",g:"113.486804,34.157184|7",cities:[{n:"郑州",g:"113.649644,34.75661|12"},{n:"安阳",g:"114.351807,36.110267|12"},{n:"鹤壁",g:"114.29777,35.755426|13"},{n:"焦作",g:"113.211836,35.234608|13"},{n:"开封",g:"114.351642,34.801854|13"},{n:"洛阳",g:"112.447525,34.657368|12"},{n:"漯河",g:"114.046061,33.576279|13"},{n:"南阳",g:"112.542842,33.01142|13"},{n:"平顶山",g:"113.300849,33.745301|13"},{n:"濮阳",g:"115.026627,35.753298|12"},{n:"三门峡",g:"111.181262,34.78332|13"},{n:"商丘",g:"115.641886,34.438589|13"},{n:"新乡",g:"113.91269,35.307258|13"},{n:"信阳",g:"114.085491,32.128582|13"},{n:"许昌",g:"113.835312,34.02674|13"},{n:"周口",g:"114.654102,33.623741|13"},{n:"驻马店",g:"114.049154,32.983158|13"}]},{n:"黑龙江",g:"128.047414,47.356592|6",cities:[{n:"哈尔滨",g:"126.657717,45.773225|12"},{n:"大庆",g:"125.02184,46.596709|12"},{n:"大兴安岭地区",g:"124.196104,51.991789|10"},{n:"鹤岗",g:"130.292472,47.338666|13"},{n:"黑河",g:"127.50083,50.25069|14"},{n:"鸡西",g:"130.941767,45.32154|13"},{n:"佳木斯",g:"130.284735,46.81378|12"},{n:"牡丹江",g:"129.608035,44.588521|13"},{n:"七台河",g:"131.019048,45.775005|14"},{n:"齐齐哈尔",g:"123.987289,47.3477|13"},{n:"双鸭山",g:"131.171402,46.655102|13"},{n:"绥化",g:"126.989095,46.646064|13"},{n:"伊春",g:"128.910766,47.734685|14"}]},{n:"湖北",g:"112.410562,31.209316|8",cities:[{n:"武汉",g:"114.3162,30.581084|12"},{n:"鄂州",g:"114.895594,30.384439|14"},{n:"恩施",g:"109.517433,30.308978|14"},{n:"黄冈",g:"114.906618,30.446109|14"},{n:"黄石",g:"115.050683,30.216127|13"},{n:"荆门",g:"112.21733,31.042611|13"},{n:"荆州",g:"112.241866,30.332591|12"},{n:"潜江",g:"112.768768,30.343116|13"},{n:"神农架林区",g:"110.487231,31.595768|13"},{n:"十堰",g:"110.801229,32.636994|13"},{n:"随州",g:"113.379358,31.717858|13"},{n:"天门",g:"113.12623,30.649047|13"},{n:"仙桃",g:"113.387448,30.293966|13"},{n:"咸宁",g:"114.300061,29.880657|13"},{n:"襄阳",g:"112.176326,32.094934|12"},{n:"孝感",g:"113.935734,30.927955|13"},{n:"宜昌",g:"111.310981,30.732758|13"}]},{n:"湖南",g:"111.720664,27.695864|7",cities:[{n:"长沙",g:"112.979353,28.213478|12"},{n:"常德",g:"111.653718,29.012149|12"},{n:"郴州",g:"113.037704,25.782264|13"},{n:"衡阳",g:"112.583819,26.898164|13"},{n:"怀化",g:"109.986959,27.557483|13"},{n:"娄底",g:"111.996396,27.741073|13"},{n:"邵阳",g:"111.461525,27.236811|13"},{n:"湘潭",g:"112.935556,27.835095|13"},{n:"湘西州",g:"109.745746,28.317951|14"},{n:"益阳",g:"112.366547,28.588088|13"},{n:"永州",g:"111.614648,26.435972|13"},{n:"岳阳",g:"113.146196,29.378007|13"},{n:"张家界",g:"110.48162,29.124889|13"},{n:"株洲",g:"113.131695,27.827433|13"}]},{n:"江苏",g:"119.368489,33.013797|8",cities:[{n:"南京",g:"118.778074,32.057236|12"},{n:"常州",g:"119.981861,31.771397|12"},{n:"淮安",g:"119.030186,33.606513|12"},{n:"连云港",g:"119.173872,34.601549|12"},{n:"南通",g:"120.873801,32.014665|12"},{n:"苏州",g:"120.619907,31.317987|12"},{n:"宿迁",g:"118.296893,33.95205|13"},{n:"泰州",g:"119.919606,32.476053|13"},{n:"无锡",g:"120.305456,31.570037|12"},{n:"徐州",g:"117.188107,34.271553|12"},{n:"盐城",g:"120.148872,33.379862|12"},{n:"扬州",g:"119.427778,32.408505|13"},{n:"镇江",g:"119.455835,32.204409|13"}]},{n:"江西",g:"115.676082,27.757258|7",cities:[{n:"南昌",g:"115.893528,28.689578|12"},{n:"抚州",g:"116.360919,27.954545|13"},{n:"赣州",g:"114.935909,25.845296|13"},{n:"吉安",g:"114.992039,27.113848|13"},{n:"景德镇",g:"117.186523,29.303563|12"},{n:"九江",g:"115.999848,29.71964|13"},{n:"萍乡",g:"113.859917,27.639544|13"},{n:"上饶",g:"117.955464,28.457623|13"},{n:"新余",g:"114.947117,27.822322|13"},{n:"宜春",g:"114.400039,27.81113|13"},{n:"鹰潭",g:"117.03545,28.24131|13"}]},{n:"吉林",g:"126.262876,43.678846|7",cities:[{n:"长春",g:"125.313642,43.898338|12"},{n:"白城",g:"122.840777,45.621086|13"},{n:"白山",g:"126.435798,41.945859|13"},{n:"吉林",g:"126.564544,43.871988|12"},{n:"辽源",g:"125.133686,42.923303|13"},{n:"四平",g:"124.391382,43.175525|12"},{n:"松原",g:"124.832995,45.136049|13"},{n:"通化",g:"125.94265,41.736397|13"},{n:"延边",g:"129.485902,42.896414|13"}]},{n:"辽宁",g:"122.753592,41.6216|8",cities:[{n:"沈阳",g:"123.432791,41.808645|12"},{n:"鞍山",g:"123.007763,41.118744|13"},{n:"本溪",g:"123.778062,41.325838|12"},{n:"朝阳",g:"120.446163,41.571828|13"},{n:"大连",g:"121.593478,38.94871|12"},{n:"丹东",g:"124.338543,40.129023|12"},{n:"抚顺",g:"123.92982,41.877304|12"},{n:"阜新",g:"121.660822,42.01925|14"},{n:"葫芦岛",g:"120.860758,40.74303|13"},{n:"锦州",g:"121.147749,41.130879|13"},{n:"辽阳",g:"123.172451,41.273339|14"},{n:"盘锦",g:"122.073228,41.141248|13"},{n:"铁岭",g:"123.85485,42.299757|13"},{n:"营口",g:"122.233391,40.668651|13"}]},{n:"内蒙古",g:"114.415868,43.468238|5",cities:[{n:"呼和浩特",g:"111.660351,40.828319|12"},{n:"阿拉善盟",g:"105.695683,38.843075|14"},{n:"包头",g:"109.846239,40.647119|12"},{n:"巴彦淖尔",g:"107.423807,40.76918|12"},{n:"赤峰",g:"118.930761,42.297112|12"},{n:"鄂尔多斯",g:"109.993706,39.81649|12"},{n:"呼伦贝尔",g:"119.760822,49.201636|12"},{n:"通辽",g:"122.260363,43.633756|12"},{n:"乌海",g:"106.831999,39.683177|13"},{n:"乌兰察布",g:"113.112846,41.022363|12"},{n:"锡林郭勒盟",g:"116.02734,43.939705|11"},{n:"兴安盟",g:"122.048167,46.083757|11"}]},{n:"宁夏",g:"106.155481,37.321323|8",cities:[{n:"银川",g:"106.206479,38.502621|12"},{n:"固原",g:"106.285268,36.021523|13"},{n:"石嘴山",g:"106.379337,39.020223|13"},{n:"吴忠",g:"106.208254,37.993561|14"},{n:"中卫",g:"105.196754,37.521124|14"}]},{n:"青海",g:"96.202544,35.499761|7",cities:[{n:"西宁",g:"101.767921,36.640739|12"},{n:"果洛州",g:"100.223723,34.480485|11"},{n:"海东地区",g:"102.085207,36.51761|11"},{n:"海北州",g:"100.879802,36.960654|11"},{n:"海南州",g:"100.624066,36.284364|11"},{n:"海西州",g:"97.342625,37.373799|11"},{n:"黄南州",g:"102.0076,35.522852|11"},{n:"玉树州",g:"97.013316,33.00624|14"}]},{n:"山东",g:"118.527663,36.09929|8",cities:[{n:"济南",g:"117.024967,36.682785|12"},{n:"滨州",g:"117.968292,37.405314|12"},{n:"东营",g:"118.583926,37.487121|12"},{n:"德州",g:"116.328161,37.460826|12"},{n:"菏泽",g:"115.46336,35.26244|13"},{n:"济宁",g:"116.600798,35.402122|13"},{n:"莱芜",g:"117.684667,36.233654|13"},{n:"聊城",g:"115.986869,36.455829|12"},{n:"临沂",g:"118.340768,35.072409|12"},{n:"青岛",g:"120.384428,36.105215|12"},{n:"日照",g:"119.50718,35.420225|12"},{n:"泰安",g:"117.089415,36.188078|13"},{n:"威海",g:"122.093958,37.528787|13"},{n:"潍坊",g:"119.142634,36.716115|12"},{n:"烟台",g:"121.309555,37.536562|12"},{n:"枣庄",g:"117.279305,34.807883|13"},{n:"淄博",g:"118.059134,36.804685|12"}]},{n:"山西",g:"112.515496,37.866566|7",cities:[{n:"太原",g:"112.550864,37.890277|12"},{n:"长治",g:"113.120292,36.201664|12"},{n:"大同",g:"113.290509,40.113744|12"},{n:"晋城",g:"112.867333,35.499834|13"},{n:"晋中",g:"112.738514,37.693362|13"},{n:"临汾",g:"111.538788,36.099745|13"},{n:"吕梁",g:"111.143157,37.527316|14"},{n:"朔州",g:"112.479928,39.337672|13"},{n:"忻州",g:"112.727939,38.461031|12"},{n:"阳泉",g:"113.569238,37.869529|13"},{n:"运城",g:"111.006854,35.038859|13"}]},{n:"陕西",g:"109.503789,35.860026|7",cities:[{n:"西安",g:"108.953098,34.2778|12"},{n:"安康",g:"109.038045,32.70437|13"},{n:"宝鸡",g:"107.170645,34.364081|12"},{n:"汉中",g:"107.045478,33.081569|13"},{n:"商洛",g:"109.934208,33.873907|13"},{n:"铜川",g:"108.968067,34.908368|13"},{n:"渭南",g:"109.483933,34.502358|13"},{n:"咸阳",g:"108.707509,34.345373|13"},{n:"延安",g:"109.50051,36.60332|13"},{n:"榆林",g:"109.745926,38.279439|12"}]},{n:"四川",g:"102.89916,30.367481|7",cities:[{n:"成都",g:"104.067923,30.679943|12"},{n:"阿坝州",g:"102.228565,31.905763|15"},{n:"巴中",g:"106.757916,31.869189|14"},{n:"达州",g:"107.494973,31.214199|14"},{n:"德阳",g:"104.402398,31.13114|13"},{n:"甘孜州",g:"101.969232,30.055144|15"},{n:"广安",g:"106.63572,30.463984|13"},{n:"广元",g:"105.819687,32.44104|13"},{n:"乐山",g:"103.760824,29.600958|13"},{n:"凉山州",g:"102.259591,27.892393|14"},{n:"泸州",g:"105.44397,28.89593|14"},{n:"南充",g:"106.105554,30.800965|13"},{n:"眉山",g:"103.84143,30.061115|13"},{n:"绵阳",g:"104.705519,31.504701|12"},{n:"内江",g:"105.073056,29.599462|13"},{n:"攀枝花",g:"101.722423,26.587571|14"},{n:"遂宁",g:"105.564888,30.557491|12"},{n:"雅安",g:"103.009356,29.999716|13"},{n:"宜宾",g:"104.633019,28.769675|13"},{n:"资阳",g:"104.63593,30.132191|13"},{n:"自贡",g:"104.776071,29.359157|13"}]},{n:"西藏",g:"89.137982,31.367315|6",cities:[{n:"拉萨",g:"91.111891,29.662557|13"},{n:"阿里地区",g:"81.107669,30.404557|11"},{n:"昌都地区",g:"97.185582,31.140576|15"},{n:"林芝地区",g:"94.349985,29.666941|11"},{n:"那曲地区",g:"92.067018,31.48068|14"},{n:"日喀则地区",g:"88.891486,29.269023|14"},{n:"山南地区",g:"91.750644,29.229027|11"}]},{n:"新疆",g:"85.614899,42.127001|6",cities:[{n:"乌鲁木齐",g:"87.564988,43.84038|12"},{n:"阿拉尔",g:"81.291737,40.61568|13"},{n:"阿克苏地区",g:"80.269846,41.171731|12"},{n:"阿勒泰地区",g:"88.137915,47.839744|13"},{n:"巴音郭楞",g:"86.121688,41.771362|12"},{n:"博尔塔拉州",g:"82.052436,44.913651|11"},{n:"昌吉州",g:"87.296038,44.007058|13"},{n:"哈密地区",g:"93.528355,42.858596|13"},{n:"和田地区",g:"79.930239,37.116774|13"},{n:"喀什地区",g:"75.992973,39.470627|12"},{n:"克拉玛依",g:"84.88118,45.594331|13"},{n:"克孜勒苏州",g:"76.137564,39.750346|11"},{n:"石河子",g:"86.041865,44.308259|13"},{n:"塔城地区",g:"82.974881,46.758684|12"},{n:"图木舒克",g:"79.198155,39.889223|13"},{n:"吐鲁番地区",g:"89.181595,42.96047|13"},{n:"五家渠",g:"87.565449,44.368899|13"},{n:"伊犁州",g:"81.297854,43.922248|11"}]},{n:"云南",g:"101.592952,24.864213|7",cities:[{n:"昆明",g:"102.714601,25.049153|12"},{n:"保山",g:"99.177996,25.120489|13"},{n:"楚雄州",g:"101.529382,25.066356|13"},{n:"大理州",g:"100.223675,25.5969|14"},{n:"德宏州",g:"98.589434,24.44124|14"},{n:"迪庆州",g:"99.713682,27.831029|14"},{n:"红河州",g:"103.384065,23.367718|11"},{n:"丽江",g:"100.229628,26.875351|13"},{n:"临沧",g:"100.092613,23.887806|14"},{n:"怒江州",g:"98.859932,25.860677|14"},{n:"普洱",g:"100.980058,22.788778|14"},{n:"曲靖",g:"103.782539,25.520758|12"},{n:"昭通",g:"103.725021,27.340633|13"},{n:"文山",g:"104.089112,23.401781|14"},{n:"西双版纳",g:"100.803038,22.009433|13"},{n:"玉溪",g:"102.545068,24.370447|13"}]},{n:"浙江",g:"119.957202,29.159494|8",cities:[{n:"杭州",g:"120.219375,30.259244|12"},{n:"湖州",g:"120.137243,30.877925|12"},{n:"嘉兴",g:"120.760428,30.773992|13"},{n:"金华",g:"119.652576,29.102899|12"},{n:"丽水",g:"119.929576,28.4563|13"},{n:"宁波",g:"121.579006,29.885259|12"},{n:"衢州",g:"118.875842,28.95691|12"},{n:"绍兴",g:"120.592467,30.002365|13"},{n:"台州",g:"121.440613,28.668283|13"},{n:"温州",g:"120.690635,28.002838|12"},{n:"舟山",g:"122.169872,30.03601|13"}]}],other:[{n:"香港",g:"114.186124,22.293586|11"},{n:"澳门",g:"113.557519,22.204118|13"},{n:"台湾",g:"120.961454,23.80406|8"}]},X={getProvinceNameByCityName:function(t){for(var e=Q.provinces,n=0;n<e.length;n++)for(var i=e[n].n,r=e[n].cities,o=0;o<r.length;o++)if(r[o].n==t)return i;return null},getCenterByCityName:function(t){t=t.replace("市","");for(n=0;n<Q.municipalities.length;n++)if(Q.municipalities[n].n==t)return i(Q.municipalities[n].g);for(n=0;n<Q.other.length;n++)if(Q.other[n].n==t)return i(Q.other[n].g);for(var e=Q.provinces,n=0;n<e.length;n++){if(e[n].n==t)return i(e[n].g);for(var r=e[n].cities,o=0;o<r.length;o++)if(r[o].n==t)return i(r[o].g)}return null}},K=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},$=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),tt=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},et=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},nt=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();(r.prototype=Object.create(n.prototype)).add=function(t,e){if(Array.isArray(t)){for(var n=0,i=t.length;n<i;n++)if(t[n]){if(t[n].time&&14==t[n].time.length&&"20"==t[n].time.substr(0,2)){var r=t[n].time;t[n].time=new Date(r.substr(0,4)+"-"+r.substr(4,2)+"-"+r.substr(6,2)+" "+r.substr(8,2)+":"+r.substr(10,2)+":"+r.substr(12,2)).getTime()}this._data.push(t[n])}}else{if(!(t instanceof Object))throw new Error("Unknown dataType");this._data.push(t)}this._dataCache=JSON.parse(JSON.stringify(this._data))},r.prototype.reset=function(){this._data=JSON.parse(JSON.stringify(this._dataCache))},r.prototype.get=function(t){t=t||{};new Date;var e=this._data;new Date;if(t.filter){for(var n=[],i=0;i<e.length;i++)t.filter(e[i])&&n.push(e[i]);e=n}return t.transferCoordinate&&(e=this.transferCoordinate(e,t.transferCoordinate,t.fromColumn,t.toColumn)),e},r.prototype.set=function(t){this._set(t),this._trigger("change")},r.prototype._set=function(t){this.clear(),this.add(t)},r.prototype.clear=function(t){this._data=[]},r.prototype.remove=function(t){},r.prototype.update=function(t,e){for(var n=this._data,i=0;i<n.length;i++)if(e){var r=!0;for(var o in e)n[i][o]!=e[o]&&(r=!1);r&&t&&t(n[i])}else t&&t(n[i]);this._dataCache=JSON.parse(JSON.stringify(this._data)),this._trigger("change")},r.prototype.transferCoordinate=function(t,e,n,i){function r(t){for(var n=[],i=0;i<t.length;i++){for(var r=t[i],o=[],a=0;a<r.length;a++)o.push(e(r[a]));n.push(o)}return n}i=i||"_coordinates",n=n||"coordinates";for(var o=0;o<t.length;o++){var a=t[o].geometry,s=a[n];switch(a.type){case"Point":a[i]=e(s);break;case"LineString":for(var l=[],h=0;h<s.length;h++)l.push(e(s[h]));a[i]=l;break;case"MultiLineString":case"Polygon":l=r(s);a[i]=l;break;case"MultiPolygon":for(var l=[],u=0;u<s.length;u++){var g=r(g=s[u]);l.push(g)}a[i]=l}}return t},r.prototype.initGeometry=function(t){t?this._data.forEach(function(e){e.geometry=t(e)}):this._data.forEach(function(t){if(!t.geometry)if(t.lng&&t.lat)t.geometry={type:"Point",coordinates:[t.lng,t.lat]};else if(t.city){var e=X.getCenterByCityName(t.city);e&&(t.geometry={type:"Point",coordinates:[e.lng,e.lat]})}})},r.prototype.getMax=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=parseFloat(e[0][t]),i=1;i<e.length;i++){var r=parseFloat(e[i][t]);r>n&&(n=r)}return n}},r.prototype.getSum=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=0,i=0;i<e.length;i++)e[i][t]&&(n+=parseFloat(e[i][t]));return n}},r.prototype.getMin=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=parseFloat(e[0][t]),i=1;i<e.length;i++){var r=parseFloat(e[i][t]);r<n&&(n=r)}return n}},r.prototype.getUnique=function(t){if((i=this._data)&&!(i.length<=0)){for(var e={},n=1;n<i.length;n++)e[i[n][t]]=!0;var i=[];for(var r in e)i.push(r);return i}};var it=it||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)},update:function(e,n){if(0===t.length)return!1;var i=0;for(e=void 0!==e?e:it.now();i<t.length;)t[i].update(e)||n?i++:t.splice(i,1);return!0}}}();"undefined"==typeof window&&"undefined"!=typeof process?it.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?it.now=window.performance.now.bind(window.performance):void 0!==Date.now?it.now=Date.now:it.now=function(){return(new Date).getTime()},it.Tween=function(t){var e,n=t,i={},r={},o={},a=1e3,s=0,l=!1,h=!1,u=!1,g=0,c=null,f=it.Easing.Linear.None,v=it.Interpolation.Linear,p=[],d=null,y=!1,m=null,x=null,w=null;this.to=function(t,e){return r=t,void 0!==e&&(a=e),this},this.start=function(t){it.add(this),h=!0,y=!1,c=void 0!==t?t:it.now(),c+=g;for(var e in r){if(r[e]instanceof Array){if(0===r[e].length)continue;r[e]=[n[e]].concat(r[e])}void 0!==n[e]&&(i[e]=n[e],i[e]instanceof Array==!1&&(i[e]*=1),o[e]=i[e]||0)}return this},this.stop=function(){return h?(it.remove(this),h=!1,null!==w&&w.call(n,n),this.stopChainedTweens(),this):this},this.end=function(){return this.update(c+a),this},this.stopChainedTweens=function(){for(var t=0,e=p.length;t<e;t++)p[t].stop()},this.delay=function(t){return g=t,this},this.repeat=function(t){return s=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return l=t,this},this.easing=function(t){return f=t,this},this.interpolation=function(t){return v=t,this},this.chain=function(){return p=arguments,this},this.onStart=function(t){return d=t,this},this.onUpdate=function(t){return m=t,this},this.onComplete=function(t){return x=t,this},this.onStop=function(t){return w=t,this},this.update=function(t){var h,w,b;if(t<c)return!0;!1===y&&(null!==d&&d.call(n,n),y=!0),b=f(w=(w=(t-c)/a)>1?1:w);for(h in r)if(void 0!==i[h]){var _=i[h]||0,S=r[h];S instanceof Array?n[h]=v(S,b):("string"==typeof S&&(S="+"===S.charAt(0)||"-"===S.charAt(0)?_+parseFloat(S):parseFloat(S)),"number"==typeof S&&(n[h]=_+(S-_)*b))}if(null!==m&&m.call(n,b),1===w){if(s>0){isFinite(s)&&s--;for(h in o){if("string"==typeof r[h]&&(o[h]=o[h]+parseFloat(r[h])),l){var P=o[h];o[h]=r[h],r[h]=P}i[h]=o[h]}return l&&(u=!u),c=void 0!==e?t+e:t+g,!0}null!==x&&x.call(n,n);for(var M=0,k=p.length;M<k;M++)p[M].start(c+a);return!1}return!0}},it.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-it.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*it.Easing.Bounce.In(2*t):.5*it.Easing.Bounce.Out(2*t-1)+.5}}},it.Interpolation={Linear:function(t,e){var n=t.length-1,i=n*e,r=Math.floor(i),o=it.Interpolation.Utils.Linear;return e<0?o(t[0],t[1],i):e>1?o(t[n],t[n-1],n-i):o(t[r],t[r+1>n?n:r+1],i-r)},Bezier:function(t,e){for(var n=0,i=t.length-1,r=Math.pow,o=it.Interpolation.Utils.Bernstein,a=0;a<=i;a++)n+=r(1-e,i-a)*r(e,a)*t[a]*o(i,a);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,r=Math.floor(i),o=it.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(r=Math.floor(i=n*(1+e))),o(t[(r-1+n)%n],t[r],t[(r+1)%n],t[(r+2)%n],i-r)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[n]-(o(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):o(t[r?r-1:0],t[r],t[n<r+1?n:r+1],t[n<r+2?n:r+2],i-r)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=it.Interpolation.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){var t=[1];return function(e){var n=1;if(t[e])return t[e];for(var i=e;i>1;i--)n*=i;return t[e]=n,n}}(),CatmullRom:function(t,e,n,i,r){var o=.5*(n-t),a=.5*(i-e),s=r*r;return(2*e-2*n+o+a)*(r*s)+(-3*e+3*n-2*o-a)*s+o*r+e}}},a.prototype.setMax=function(t){this.max=t||100},a.prototype.setMin=function(t){this.min=t||0},a.prototype.setMaxSize=function(t){this.maxSize=t||35},a.prototype.setMinSize=function(t){this.minSize=t||0},a.prototype.initPalette=function(){var t=this.gradient,e=new o(256,1),n=this.paletteCtx=e.getContext("2d"),i=n.createLinearGradient(0,0,256,1);for(var r in t)i.addColorStop(parseFloat(r),t[r]);n.fillStyle=i,n.fillRect(0,0,256,1)},a.prototype.getColor=function(t){var e=this.getImageData(t);return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/256+")"},a.prototype.getImageData=function(t){var e=this.paletteCtx.getImageData(0,0,256,1).data;if(void 0===t)return e;var n=this.max,i=this.min;t>n&&(t=n),t<i&&(t=i);var r=4*Math.floor((t-i)/(n-i)*255);return[e[r],e[r+1],e[r+2],e[r+3]]},a.prototype.getSize=function(t){var e=this.max,n=this.min,i=this.maxSize,r=this.minSize;return t>e&&(t=e),t<n&&(t=n),e>n?r+(t-n)/(e-n)*(i-r):i},a.prototype.getLegend=function(t){var e=this.gradient,n=t.width||20,i=t.height||180,r=new o(n,i),a=r.getContext("2d"),s=a.createLinearGradient(0,i,0,0);for(var l in e)s.addColorStop(parseFloat(l),e[l]);return a.fillStyle=s,a.fillRect(0,0,n,i),r},s.prototype.get=function(t){var e=this.splitList,n=e.other;for(var i in e)if(t==i){n=e[i];break}return n},s.prototype.generateByDataSet=function(t,e){var n=e||["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],i=t.get();this.splitList={};for(var r=0,o=0;o<i.length&&(void 0===this.splitList[i[o].count]&&(this.splitList[i[o].count]=n[r],r++),!(r>=n.length-1));o++);this.splitList.other=n[n.length-1]},s.prototype.getLegend=function(t){var e=this.splitList,n=document.createElement("div");n.style.cssText="background:#fff; padding: 5px; border: 1px solid #ccc;";var i="";for(var r in e)i+='<div style="line-height: 19px;" value="'+r+'"><span style="vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:'+e[r]+';"></span><span style="margin-left: 3px;">'+r+"<span></div>";return n.innerHTML=i,n},l.prototype.get=function(t){for(var e=this.splitList,n=!1,i=0;i<e.length;i++)if((void 0===e[i].start||void 0!==e[i].start&&t>=e[i].start)&&(void 0===e[i].end||void 0!==e[i].end&&t<e[i].end)){n=e[i].value;break}return n},l.prototype.generateByDataSet=function(t){var e=t.getMin("count"),n=t.getMax("count");this.generateByMinMax(e,n)},l.prototype.generateByMinMax=function(t,e){var n=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],i=Number((e-t)/7);e=Number(e);var r=Number(t);this.splitList=[];for(var o=0;r<e;)this.splitList.push({start:r,end:r+i,value:n[o]}),o++,r+=i},l.prototype.getLegend=function(t){this.splitList};var rt={drawDataSet:function(t,e,n){for(var i=e instanceof r?e.get():e,o=0,a=i.length;o<a;o++){var s=i[o];this.draw(t,s,n)}},draw:function(t,e,n){var i=e.geometry.type,r=e.geometry._coordinates||e.geometry.coordinates,o=e.symbol||n.symbol||"circle";switch(i){case"Point":var a=e._size||e.size||n._size||n.size||5;"circle"===o?("Point"===n.bigData&&t.moveTo(r[0],r[1]),t.arc(r[0],r[1],a,0,2*Math.PI)):"rect"===o?t.rect(r[0]-a/2,r[1]-a/2,a,a):"honeycomb"===o&&function(t,e,n,i){for(var r=0;r<6;r++){var o=h({x:e,y:n},i,r);t.lineTo(o[0],o[1])}}(t,r[0],r[1],a);break;case"LineString":this.drawLineString(t,r);break;case"MultiLineString":for(l=0;l<r.length;l++){var s=r[l];this.drawLineString(t,s)}break;case"Polygon":this.drawPolygon(t,r);break;case"MultiPolygon":for(var l=0;l<r.length;l++){var u=r[l];if(this.drawPolygon(t,u),n.multiPolygonDraw){var g=n.multiPolygonDraw();if(g)return g}}break;default:console.error("type"+i+"is not support now!")}},drawLineString:function(t,e){for(var n=0;n<e.length;n++){var i=e[n][0],r=e[n][1];0==n?t.moveTo(i,r):t.lineTo(i,r)}},drawPolygon:function(t,e){t.beginPath();for(var n=0;n<e.length;n++){var i=e[n];t.moveTo(i[0][0],i[0][1]);for(var r=1;r<i.length;r++)t.lineTo(i[r][0],i[r][1]);t.lineTo(i[0][0],i[0][1]),t.closePath()}}},ot=("undefined"==typeof window?{}:window).devicePixelRatio||1,at={draw:function(t,e,n){if(!(t.canvas.width<=0||t.canvas.height<=0)){var i=n.strength||.3;t.strokeStyle="rgba(0,0,0,"+i+")";var s=new o(t.canvas.width,t.canvas.height),l=s.getContext("2d");l.scale(ot,ot),n=n||{};var h=e instanceof r?e.get():e;t.save();var g=new a({gradient:n.gradient});if(f(l,h,n),!n.absolute){var c=l.getImageData(0,0,t.canvas.width,t.canvas.height);u(c.data,g.getImageData(),n),t.putImageData(c,0,0),t.restore()}g=null,s=null}}},st={},lt={draw:function(t,e,n){var i="http://huiyan.baidu.com/github/tools/gis-drawing/static/images/direction.png";n.arrow&&n.arrow.url&&(i=n.arrow.url),st[i]||(st[i]=null);var o=st[i];if(!o){var a=Array.prototype.slice.call(arguments),s=new Image;return s.onload=function(){st[i]=s,lt.draw.apply(null,a)},void(s.src=i)}var l=e instanceof r?e.get():e;t.save();for(var h in n)t[h]=n[h];for(var u=[],g=null,c=0,f=l.length;c<f;c++){var p=l[c];t.save(),(p.fillStyle||p._fillStyle)&&(t.fillStyle=p.fillStyle||p._fillStyle),(p.strokeStyle||p._strokeStyle)&&(t.strokeStyle=p.strokeStyle||p._strokeStyle);var d=p.geometry.type;if(t.beginPath(),"LineString"===d)for(var y=p.geometry._coordinates||p.geometry.coordinates,m=void 0!==n.arrow.interval?n.arrow.interval:1,x=0;x<y.length;x+=m)if(y[x]&&y[x+1]){var w=y[x];if(g&&function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}(w,g)<30)continue;t.save();var b=v(y[x],y[x+1]);t.translate(w[0],w[1]),t.rotate(b*Math.PI/180),t.drawImage(o,-o.width/2/2,-o.height/2/2,o.width/2,o.height/2),t.restore(),u.push(w),g=w}t.restore()}t.restore()}},ht={draw:function(t,e,n){var i=e instanceof r?e.get():e;t.save();for(var o in n)t[o]=n[o];if(n.bigData){t.save(),t.beginPath();for(var a=0,s=i.length;a<s;a++){l=i[a];rt.draw(t,l,n)}"Point"==(h=n.bigData)||"Polygon"==h||"MultiPolygon"==h?(t.fill(),t.lineDash&&t.setLineDash(t.lineDash),l.lineDash&&t.setLineDash(l.lineDash),(l.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"!=h&&"MultiLineString"!=h||t.stroke(),t.restore()}else for(var a=0,s=i.length;a<s;a++){var l=i[a];t.save(),(l.fillStyle||l._fillStyle)&&(t.fillStyle=l.fillStyle||l._fillStyle),(l.strokeStyle||l._strokeStyle)&&(t.strokeStyle=l.strokeStyle||l._strokeStyle),t.lineDash&&t.setLineDash(t.lineDash),l.lineDash&&t.setLineDash(l.lineDash);var h=l.geometry.type;t.beginPath(),n.multiPolygonDraw=function(){t.fill(),(l.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()},rt.draw(t,l,n),"Point"==h||"Polygon"==h||"MultiPolygon"==h?(t.fill(),(l.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"!=h&&"MultiLineString"!=h||((l.lineWidth||l._lineWidth)&&(t.lineWidth=l.lineWidth||l._lineWidth),t.stroke()),t.restore()}t.restore()}},ut=function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)},gt={draw:function(t,e,n){var i=e instanceof r?e.get():e;t.save(),t.fillStyle=n.fillStyle||"rgba(0, 0, 0, 0.5)",t.fillRect(0,0,t.canvas.width,t.canvas.height),n.multiPolygonDraw=function(){t.save(),t.clip(),ut(t),t.restore()};for(var o=0,a=i.length;o<a;o++)t.beginPath(),rt.drawDataSet(t,[i[o]],n),t.save(),t.clip(),ut(t),t.restore();t.restore()}},ct=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),ft=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),vt={draw:function(t,e,n){if(e){var i=d(t,ct,ft);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),t.clear(t.COLOR_BUFFER_BIT);var r=t.canvas.width/2,o=t.canvas.height/2,a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);var s=t.getAttribLocation(i,"a_Position");t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s);var l=t.getUniformLocation(i,"u_FragColor"),h=y(n.strokeStyle||"red");t.uniform4f(l,h[0]/255,h[1]/255,h[2]/255,h[3]/255),t.lineWidth(n.lineWidth||1);for(var u=0,g=e.length;u<g;u++){for(var c=e[u].geometry._coordinates,f=[],v=0;v<c.length;v++){var p=c[v],m=(p[0]-r)/r,x=(o-p[1])/o;f.push(m,x)}var w=new Float32Array(f);t.bufferData(t.ARRAY_BUFFER,w,t.STATIC_DRAW),t.drawArrays(t.LINE_STRIP,0,c.length)}}}},pt=["attribute vec4 a_Position;","attribute float a_PointSize;","void main() {","gl_Position = a_Position;","gl_PointSize = a_PointSize;","}"].join(""),dt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),yt={draw:function(t,e,n){if(e){var i=d(t,pt,dt),r=t.getAttribLocation(i,"a_Position"),o=t.getAttribLocation(i,"a_PointSize"),a=t.getUniformLocation(i,"u_FragColor");t.clear(t.COLOR_BUFFER_BIT);for(var s=t.canvas.width/2,l=t.canvas.height/2,h=[],u=0,g=0;g<e.length;g++){var c=e[g].geometry._coordinates,f=(c[0]-s)/s,v=(l-c[1])/l;f<-1||f>1||v<-1||v>1||(h.push(f,v),u++)}var p=new Float32Array(h),m=u,x=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,x),t.bufferData(t.ARRAY_BUFFER,p,t.STATIC_DRAW),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(r),t.vertexAttrib1f(o,n._size);var w=y(n.fillStyle||"red");t.uniform4f(a,w[0]/255,w[1]/255,w[2]/255,w[3]/255),t.drawArrays(t.POINTS,0,m)}}};m.deviation=function(t,e,n,i){var r=e&&e.length,o=r?e[0]*n:t.length,a=Math.abs(D(t,0,o,n));if(r)for(var s=0,l=e.length;s<l;s++){var h=e[s]*n,u=s<l-1?e[s+1]*n:t.length;a-=Math.abs(D(t,h,u,n))}var g=0;for(s=0;s<i.length;s+=3){var c=i[s]*n,f=i[s+1]*n,v=i[s+2]*n;g+=Math.abs((t[c]-t[v])*(t[f+1]-t[c+1])-(t[c]-t[f])*(t[v+1]-t[c+1]))}return 0===a&&0===g?0:Math.abs((g-a)/a)},m.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[r][o][a]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};var mt=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),xt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),wt={draw:function(t,e,n){if(e){t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,t.canvas.width,t.canvas.height);var i=d(t,mt,xt);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE);var r=t.canvas.width/2,o=t.canvas.height/2;t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer());var a=t.getAttribLocation(i,"a_Position");t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);var s=t.getUniformLocation(i,"u_FragColor"),l=y(n.fillStyle||"red");t.uniform4f(s,l[0]/255,l[1]/255,l[2]/255,l[3]/255),t.lineWidth(n.lineWidth||1);for(var h=[],u=[],g=0,c=0,f=e.length;c<f;c++){var v=m.flatten(e[c].geometry._coordinates||e[c].geometry.coordinates),p=v.vertices;for(g=h.length/2,w=0;w<p.length;w+=2)p[w]=(p[w]-r)/r,p[w+1]=(o-p[w+1])/o;for((h.length+p.length)/2>65536&&(t.bufferData(t.ARRAY_BUFFER,new Float32Array(h),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,u.length,t.UNSIGNED_SHORT,0),h.length=0,u.length=0,g=0),w=0;w<p.length;w++)h.push(p[w]);for(var x=m(p,v.holes,v.dimensions),w=0;w<x.length;w++)u.push(x[w]+g)}t.bufferData(t.ARRAY_BUFFER,new Float32Array(h),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,u.length,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},bt={draw:function(t,e,n){var i=e instanceof r?e.get():e;i.length>0&&("LineString"==i[0].geometry.type?vt.draw(t,i,n):"Polygon"==i[0].geometry.type||"MultiPolygon"==i[0].geometry.type?wt.draw(t,i,n):yt.draw(t,i,n))}},_t={draw:function(t,e,n){t.save();var i=e instanceof r?e.get():e,o={},s=n._size||n.size||50,l=!("enableCluster"in n)||n.enableCluster,h=n.offset||{x:0,y:0},u=new a({min:n.min||0,max:n.max||100,gradient:n.gradient});if(l){for(var g=0;g<i.length;g++){v=i[g].geometry._coordinates||i[g].geometry.coordinates;o[d=Math.floor((v[0]-h.x)/s)+","+Math.floor((v[1]-h.y)/s)]||(o[d]=0),o[d]+=~~(i[g].count||1)}for(var c in o)c=c.split(","),t.beginPath(),t.rect(c[0]*s+.5+h.x,c[1]*s+.5+h.y,s,s),t.fillStyle=u.getColor(o[c]),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}else{for(var f=0;f<i.length;f++){var v;o[d=(v=i[f].geometry._coordinates||i[f].geometry.coordinates).join(",")]=i[f].count||1}for(var p in o)p=p.split(","),t.beginPath(),t.rect(+p[0]-s/2,+p[1]-s/2,s,s),t.fillStyle=u.getColor(o[p]),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&!1!==n.label.show){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);for(var d in o){var y=o[d=d.split(",")],m=t.measureText(y).width;l?t.fillText(y,d[0]*s+.5+h.x+s/2-m/2,d[1]*s+.5+h.y+s/2+5):t.fillText(y,+d[0]-m/2,+d[1]+5)}}t.restore()}},St={},Pt={},Mt={draw:function(t,e,n){t.save();for(var i=e instanceof r?e.get():e,o=0;o<i.length;o++){var a=i[o],s=a.geometry._coordinates||a.geometry.coordinates;if(t.beginPath(),a.properties&&a.properties.cluster){if(t.arc(s[0],s[1],a.size,0,2*Math.PI),t.fillStyle=a.fillStyle,t.fill(),n.label&&!1!==n.label.show){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);var l=a.properties.point_count,h=t.measureText(l).width;t.fillText(l,s[0]+.5-h/2,s[1]+.5+3)}}else this.drawIcon(a,n,t)}t.restore()},drawIcon:function(t,e,n){var i=t.geometry._coordinates||t.geometry.coordinates,r=nt(i,2),o=r[0],a=r[1],s=Object.assign({},e.iconOptions,t.iconOptions),l=function(){n.beginPath(),n.arc(o,a,e.size||5,0,2*Math.PI),n.fillStyle=e.fillStyle||"red",n.fill()};if(s.url){var h=s.width,u=s.height,g=s.offset||{x:0,y:0};o=o-~~h/2+g.x,a=a-~~u/2+g.y;var c=window.encodeURIComponent(s.url),f=St[c];f?"error"===f?l():h&&u?n.drawImage(f,o,a,h,u):n.drawImage(f,o,a):(Pt[c]||(Pt[c]=[],function(t,e,n){var i=new Image;i.onload=function(){e&&e(i,t)},i.onerror=function(){n&&n(t)},i.src=window.decodeURIComponent(t)}(c,function(t,e){Pt[e]&&Pt[e].forEach(function(e){return e(t)}),Pt[e]=null,St[e]=t},function(t){Pt[t]&&Pt[t].forEach(function(e){return e("error",t)}),Pt[t]=null,St[t]="error",l()})),Pt[c].push(function(t,e,i,r){return function(o){"error"===o?l():i&&r?n.drawImage(o,t,e,i,r):n.drawImage(o,t,e)}}(o,a,h,u)))}else l()}},kt={draw:function(t,e,n){t.save();var i=e instanceof r?e.get():e;for(var o in n)t[o]=n[o];for(var s=n.offset||{x:10,y:10},l=n._size||n.size||40,h=2*(l=l/2/Math.sin(Math.PI/3))*Math.sin(Math.PI/3),u=1.5*l,g={},c=0;c<i.length;c++){var f=i[c].geometry._coordinates||i[c].geometry.coordinates,v=(f[1]-s.y)/u,p=Math.round(v),d=(f[0]-s.x)/h-(1&p?.5:0),y=Math.round(d),m=v-p;if(3*Math.abs(m)>1){var x=d-y,w=y+(d<y?-1:1)/2,b=p+(v<p?-1:1),_=d-w,S=v-b;x*x+m*m>_*_+S*S&&(y=w+(1&p?1:-1)/2,p=b)}var P=y+"-"+p,M=g[P];M?M.push(i[c]):((M=g[P]=[i[c]]).i=y,M.j=p,M.x=(y+(1&p?.5:0))*h,M.y=p*u)}var k=new a({max:n.max||100,maxSize:l,gradient:n.gradient});for(var o in g){L=g[o];t.beginPath();for(var E=0;E<6;E++){var C=O({x:L.x+s.x,y:L.y+s.y},l,E);t.lineTo(C[0],C[1])}t.closePath();for(var I=0,c=0;c<L.length;c++)I+=L[c].count||1;L.count=I,t.fillStyle=k.getColor(I),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&!1!==n.label.show){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);for(var o in g){var L,A=(L=g[o]).count;A=A<0?A.toFixed(2):~~A;var R=t.measureText(A).width;t.fillText(A,L.x+s.x-R/2,L.y+s.y+5)}}t.restore()}},Et={draw:function(t,e,n){var i=e instanceof r?e.get():e;t.save();for(var o in n)t[o]=n[o];var a=[],s=n._size||n.size;s?t.font="bold "+s+"px Arial":s=12;var l=n.textKey||"text";if(n.textAlign||(t.textAlign="center"),n.textBaseline||(t.textBaseline="middle"),n.avoid)for(var h=0,u=i.length;h<u;h++){var g=i[h].offset||n.offset||{x:0,y:0},c=(x=i[h].geometry._coordinates||i[h].geometry.coordinates)[0]+g.x,f=x[1]+g.y,v=i[h][l],p=t.measureText(v).width,d=c-p/2,y=f-s/2,m={sw:{x:d,y:y+s},ne:{x:d+p,y:y}};B(a,m)||(a.push(m),d+=p/2,y+=s/2,t.fillText(v,d,y))}else for(var h=0,u=i.length;h<u;h++){var g=i[h].offset||n.offset||{x:0,y:0},x=i[h].geometry._coordinates||i[h].geometry.coordinates,c=x[0]+g.x,f=x[1]+g.y,v=i[h][l];t.fillText(v,c,f)}t.restore()}},Ct={},It={},Lt={draw:function(t,e,n){for(var i=e instanceof r?e.get():e,o=function(){var e=i[a];if(e.geometry)if("string"==typeof(l=e.icon||n.icon)){var r=window.encodeURIComponent(l),o=Ct[r];o?F(o,n,t,e):(It[r]||(It[r]=[],function(t,e,n){var i=new Image;i.onload=function(){e&&e(i,t)},i.onerror=function(){n&&n(t)},i.src=window.decodeURIComponent(t)}(r,function(t,e){It[e]&&It[e].forEach(function(e){return e(t)}),It[e]=null,Ct[e]=t},function(t){It[t]&&It[t].forEach(function(t){return t("error")}),It[t]=null,Ct[t]="error"})),It[r].push(function(i){F(i,n,t,e)}))}else F(l,n,t,e)},a=0,s=i.length;a<s;a++){var l;o()}}},At=function(t){return t[0]},Rt=function(t){return t[1]},Dt=function(t,e,n,i,r){void 0===e&&(e=At),void 0===n&&(n=Rt),void 0===i&&(i=64),void 0===r&&(r=Float64Array),this.nodeSize=i,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new r(2*t.length),l=0;l<t.length;l++)a[l]=l,s[2*l]=e(t[l]),s[2*l+1]=n(t[l]);T(a,s,i,0,a.length-1,0)};Dt.prototype.range=function(t,e,n,i){return function(t,e,n,i,r,o,a){for(var s,l,h=[0,t.length-1,0],u=[];h.length;){var g=h.pop(),c=h.pop(),f=h.pop();if(c-f<=a)for(var v=f;v<=c;v++)s=e[2*v],l=e[2*v+1],s>=n&&s<=r&&l>=i&&l<=o&&u.push(t[v]);else{var p=Math.floor((f+c)/2);s=e[2*p],l=e[2*p+1],s>=n&&s<=r&&l>=i&&l<=o&&u.push(t[p]);var d=(g+1)%2;(0===g?n<=s:i<=l)&&(h.push(f),h.push(p-1),h.push(d)),(0===g?r>=s:o>=l)&&(h.push(p+1),h.push(c),h.push(d))}}return u}(this.ids,this.coords,t,e,n,i,this.nodeSize)},Dt.prototype.within=function(t,e,n){return function(t,e,n,i,r,o){for(var a=[0,t.length-1,0],s=[],l=r*r;a.length;){var h=a.pop(),u=a.pop(),g=a.pop();if(u-g<=o)for(var c=g;c<=u;c++)N(e[2*c],e[2*c+1],n,i)<=l&&s.push(t[c]);else{var f=Math.floor((g+u)/2),v=e[2*f],p=e[2*f+1];N(v,p,n,i)<=l&&s.push(t[f]);var d=(h+1)%2;(0===h?n-r<=v:i-r<=p)&&(a.push(g),a.push(f-1),a.push(d)),(0===h?n+r>=v:i+r>=p)&&(a.push(f+1),a.push(u),a.push(d))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var Ot={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},Bt=function(t){this.options=V(Object.create(Ot),t),this.trees=new Array(this.options.maxZoom+1)};Bt.prototype.load=function(t){var e=this.options,n=(e.log,e.minZoom),i=e.maxZoom,r=e.nodeSize;t.length;this.points=t;for(var o=[],a=0;a<t.length;a++)t[a].geometry&&o.push(function(t,e){var n=t.geometry.coordinates,i=n[0],r=n[1];return{x:Y(i),y:q(r),zoom:1/0,index:e,parentId:-1}}(t[a],a));this.trees[i+1]=new Dt(o,G,H,r,Float32Array);for(var s=i;s>=n;s--){Date.now();o=this._cluster(o,s),this.trees[s]=new Dt(o,G,H,r,Float32Array)}return this},Bt.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){var a=this.getClusters([n,i,180,o],e),s=this.getClusters([-180,i,r,o],e);return a.concat(s)}for(var l=this.trees[this._limitZoom(e)],h=[],u=0,g=l.range(Y(n),q(o),Y(r),q(i));u<g.length;u+=1){var c=g[u],f=l.points[c];h.push(f.numPoints?j(f):this.points[f.index])}return h},Bt.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);var o=r.points[e];if(!o)throw new Error(i);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],l=0,h=r.within(o.x,o.y,a);l<h.length;l+=1){var u=h[l],g=r.points[u];g.parentId===t&&s.push(g.numPoints?j(g):this.points[g.index])}if(0===s.length)throw new Error(i);return s},Bt.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var i=[];return this._appendLeaves(i,t,e,n,0),i},Bt.prototype.getTile=function(t,e,n){var i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,l=(n-s)/r,h=(n+1+s)/r,u={features:[]};return this._addTileFeatures(i.range((e-s)/r,l,(e+1+s)/r,h),i.points,e,n,r,u),0===e&&this._addTileFeatures(i.range(1-s/r,l,1,h),i.points,r,n,r,u),e===r-1&&this._addTileFeatures(i.range(0,l,s/r,h),i.points,-1,n,r,u),u.features.length?u:null},Bt.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},Bt.prototype._appendLeaves=function(t,e,n,i,r){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],l=s.properties;if(l&&l.cluster?r+l.point_count<=i?r+=l.point_count:r=this._appendLeaves(t,l.cluster_id,n,i,r):r<i?r++:t.push(s),t.length===n)break}return r},Bt.prototype._addTileFeatures=function(t,e,n,i,r,o){for(var a=0,s=t;a<s.length;a+=1){var l=e[s[a]],h=l.numPoints,u={type:1,geometry:[[Math.round(this.options.extent*(l.x*r-n)),Math.round(this.options.extent*(l.y*r-i))]],tags:h?W(l):this.points[l.index].properties},g=void 0;h?g=l.id:this.options.generateId?g=l.index:this.points[l.index].id&&(g=this.points[l.index].id),void 0!==g&&(u.id=g),o.features.push(u)}},Bt.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},Bt.prototype._cluster=function(t,e){for(var n=[],i=this.options,r=i.radius,o=i.extent,a=i.reduce,s=i.minPoints,l=r/(o*Math.pow(2,e)),h=0;h<t.length;h++){var u=t[h];if(!(u.zoom<=e)){u.zoom=e;for(var g=this.trees[e+1],c=g.within(u.x,u.y,l),f=u.numPoints||1,v=f,p=0,d=c;p<d.length;p+=1){var y=d[p],m=g.points[y];m.zoom>e&&(v+=m.numPoints||1)}if(v>=s){for(var x=u.x*f,w=u.y*f,b=a&&f>1?this._map(u,!0):null,_=(h<<5)+(e+1)+this.points.length,S=0,P=c;S<P.length;S+=1){var M=P[S],k=g.points[M];if(!(k.zoom<=e)){k.zoom=e;var E=k.numPoints||1;x+=k.x*E,w+=k.y*E,k.parentId=_,a&&(b||(b=this._map(u,!0)),a(b,this._map(k)))}}u.parentId=_,n.push(function(t,e,n,i,r){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}(x/v,w/v,_,v,b))}else if(n.push(u),v>1)for(var C=0,I=c;C<I.length;C+=1){var L=I[C],A=g.points[L];A.zoom<=e||(A.zoom=e,n.push(A))}}}return n},Bt.prototype._getOriginId=function(t){return t-this.points.length>>5},Bt.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},Bt.prototype._map=function(t,e){if(t.numPoints)return e?V({},t.properties):t.properties;var n=this.points[t.index].properties,i=this.options.map(n);return e&&i===n?V({},i):i},"undefined"!=typeof window&&requestAnimationFrame(J);var Ft=function(){function t(e,n,i){K(this,t),n instanceof r||(n=new r(n)),this.dataSet=n,this.map=e,"cluster"===i.draw&&this.refreshCluster(i)}return $(t,[{key:"refreshCluster",value:function(t){t=t||this.options,this.supercluster=new Bt({maxZoom:t.maxZoom||19,radius:t.clusterRadius||100,minPoints:t.minPoints||2,extent:t.extent||512}),this.supercluster.load(this.dataSet.get()),this.supercluster.trees.forEach(function(t){var e=0,n=1/0;t.points.forEach(function(t){e=Math.max(t.numPoints||0,e),n=Math.min(t.numPoints||1/0,n)}),t.max=e,t.min=n}),this.clusterDataSet=new r}},{key:"getDefaultContextConfig",value:function(){return{globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"}}},{key:"initDataRange",value:function(t){if(this.intensity=new a({maxSize:this.options.maxSize,minSize:this.options.minSize,gradient:this.options.gradient,max:this.options.max||this.dataSet.getMax("count")}),this.category=new s(this.options.splitList),this.choropleth=new l(this.options.splitList),void 0===this.options.splitList&&this.category.generateByDataSet(this.dataSet,this.options.color),void 0===this.options.splitList){var e=this.options.min||this.dataSet.getMin("count"),n=this.options.max||this.dataSet.getMax("count");this.choropleth.generateByMinMax(e,n)}}},{key:"getLegend",value:function(t){this.options.draw;return"intensity"==this.options.draw||"heatmap"==this.options.draw?this.intensity.getLegend(t):"category"==this.options.draw?this.category.getLegend(t):void 0}},{key:"processData",value:function(t){var e=this.options.draw;if("bubble"==e||"intensity"==e||"category"==e||"choropleth"==e||"simple"==e)for(var n=0;n<t.length;n++){var i=t[n];"bubble"==this.options.draw?t[n]._size=this.intensity.getSize(i.count):t[n]._size=void 0;var r="_fillStyle";"LineString"!==t[n].geometry.type&&"stroke"!==this.options.styleType||(r="_strokeStyle"),"intensity"==this.options.draw?t[n][r]=this.intensity.getColor(i.count):"category"==this.options.draw?t[n][r]=this.category.get(i.count):"choropleth"==this.options.draw&&(t[n][r]=this.choropleth.get(i.count))}}},{key:"isEnabledTime",value:function(){var t=this.options.animation;return t&&!(!1===t.enabled)}},{key:"argCheck",value:function(t){"heatmap"==t.draw&&t.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")}},{key:"drawContext",value:function(t,e,n,i){switch(this.options.draw){case"heatmap":at.draw(t,e,this.options);break;case"grid":case"cluster":case"honeycomb":this.options.offset={x:i.x,y:i.y},"grid"===this.options.draw?_t.draw(t,e,this.options):"cluster"===this.options.draw?Mt.draw(t,e,this.options):kt.draw(t,e,this.options);break;case"text":Et.draw(t,e,this.options);break;case"icon":Lt.draw(t,e,this.options);break;case"clip":gt.draw(t,e,this.options);break;default:"webgl"==this.options.context?bt.draw(this.canvasLayer.canvas.getContext("webgl"),e,this.options):ht.draw(t,e,this.options)}this.options.arrow&&!1!==this.options.arrow.show&&lt.draw(t,e,this.options)}},{key:"isPointInPath",value:function(t,e){var n,t=this.canvasLayer.canvas.getContext(this.context);n="cluster"===this.options.draw&&(!this.options.maxClusterZoom||this.options.maxClusterZoom>=this.getZoom())?this.clusterDataSet.get():this.dataSet.get();for(var i=0;i<n.length;i++){t.beginPath();var r=this.options,o=e.x*this.canvasLayer.devicePixelRatio,a=e.y*this.canvasLayer.devicePixelRatio;r.multiPolygonDraw=function(){if(t.isPointInPath(o,a))return n[i]},rt.draw(t,n[i],r);if((n[i].geometry&&n[i].geometry.type).indexOf("LineString")>-1){if(t.isPointInStroke&&t.isPointInStroke(o,a))return n[i]}else if(t.isPointInPath(o,a))return n[i]}}},{key:"getClusterPoints",value:function(t){var e=this;if("Feature"!==t.type)return[];return this.supercluster.getChildren(t.id).map(function(t){return"Feature"===t.type?e.getClusterPoints(t):t}).flat()}},{key:"clickEvent",value:function(t,e){if(this.options.methods){var n=this.isPointInPath(this.getContext(),t);if(n){if("cluster"===this.options.draw){var i=this.getClusterPoints(n);n.children=i}this.options.methods.click(n,e)}else this.options.methods.click(null,e)}}},{key:"mousemoveEvent",value:function(t,e){if(this.options.methods){var n=this.isPointInPath(this.getContext(),t);if(n){if("cluster"===this.options.draw){var i=this.getClusterPoints(n);n.children=i}this.options.methods.mousemove(n,e)}else this.options.methods.mousemove(null,e)}}},{key:"tapEvent",value:function(t,e){if(this.options.methods){var n=this.isPointInPath(this.getContext(),t);if(n){if("cluster"===this.options.draw){var i=this.getClusterPoints(n);n.children=i}this.options.methods.tap(n,e)}else this.options.methods.tap(null,e)}}},{key:"update",value:function(t,e){var n=t.options,i=this.options;for(var r in n)i[r]=n[r];this.init(i),!1!==e&&this.draw()}},{key:"setOptions",value:function(t){this.dataSet.reset(),this.init(t),this.draw()}},{key:"set",value:function(t){var e=this.getContext(),n=this.getDefaultContextConfig();for(var i in n)e[i]=n[i];this.init(t.options),this.draw()}},{key:"destroy",value:function(){this.unbindEvent(),this.hide()}},{key:"initAnimator",value:function(){var t=this,e=t.options.animation;if("time"==t.options.draw||t.isEnabledTime()){e.stepsRange||(e.stepsRange={start:this.dataSet.getMin("time")||0,end:this.dataSet.getMax("time")||0}),this.steps={step:e.stepsRange.start},t.animator=new it.Tween(this.steps).onUpdate(function(){t._canvasUpdate(this.step)}).repeat(1/0),this.addAnimatorEvent();var n=1e3*e.duration||5e3;t.animator.to({step:e.stepsRange.end},n),t.animator.start()}else t.animator&&t.animator.stop()}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this.animator.stop())}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator&&this.animator.start()}}]),t}(),Tt=function(t){function n(t,e,i,r){K(this,n);var o=et(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e,i));return Ft?(o.map=t,o.scene=t.scene,o.dataSet=e,i=i||{},o.init(i),o.argCheck(i),o.initDevicePixelRatio(),o.canvasLayer=r,o.stopAniamation=!1,o.animation=i.animation,o.clickEvent=o.clickEvent.bind(o),o.mousemoveEvent=o.mousemoveEvent.bind(o),o.bindEvent(),o):et(o)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,Ft),$(n,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"clickEvent",value:function(t){var e=t.point;tt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"clickEvent",this).call(this,e,t)}},{key:"mousemoveEvent",value:function(t){var e=t.point;tt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"mousemoveEvent",this).call(this,e,t)}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start)}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator}},{key:"bindEvent",value:function(){this.map,this.options.methods&&(this.options.methods.click,this.options.methods.mousemove)}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"_canvasUpdate",value:function(t){this.map;var n=this.scene;if(this.canvasLayer&&!this.stopAniamation){var i=this.options.animation,o=this.getContext();if(this.isEnabledTime()){if(void 0===t)return void this.clear(o);"2d"===this.context&&(o.save(),o.globalCompositeOperation="destination-out",o.fillStyle="rgba(0, 0, 0, .1)",o.fillRect(0,0,o.canvas.width,o.canvas.height),o.restore())}else this.clear(o);if("2d"===this.context)for(var a in this.options)o[a]=this.options[a];else o.clear(o.COLOR_BUFFER_BIT);var s={transferCoordinate:function(t){var i=e.Cartesian3.fromDegrees(t[0],t[1]),r=e.SceneTransforms.wgs84ToWindowCoordinates(n,i);return void 0==r?[-1,-1]:[r.x,r.y]}};void 0!==t&&(s.filter=function(e){var n=i.trails||10;return!!(t&&e.time>t-n&&e.time<t)});var l=this.dataSet.get(s);this.processData(l),"m"==this.options.unit&&this.options.size,this.options._size=this.options.size;var h=e.SceneTransforms.wgs84ToWindowCoordinates(n,e.Cartesian3.fromDegrees(0,0));this.drawContext(o,new r(l),this.options,h),this.options.updateCallback&&this.options.updateCallback(t)}}},{key:"updateData",value:function(t,e){var i=t;i&&i.get&&(i=i.get()),void 0!=i&&this.dataSet.set(i),tt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"update",this).call(this,{options:e})}},{key:"addData",value:function(t,e){var n=t;t&&t.get&&(n=t.get()),this.dataSet.add(n),this.update({options:e})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}}]),n}(),zt=0,Zt=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if(K(this,t),this.map=e,this.scene=e.scene,this.mapvBaseLayer=new Tt(e,n,i,this),this.mapVOptions=i,this.initDevicePixelRatio(),this.canvas=this._createCanvas(),this.render=this.render.bind(this),r)this.container=r;else{var o=e.container.querySelector(".cesium-viewer-cesiumWidgetContainer");this.container=o||e.container}this.addInnerContainer(),this.bindEvent(),this._reset()}return $(t,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"addInnerContainer",value:function(){this.container.appendChild(this.canvas)}},{key:"bindEvent",value:function(){var t=this;this.innerMoveStart=this.moveStartEvent.bind(this),this.innerMoveEnd=this.moveEndEvent.bind(this),this.scene.camera.moveStart.addEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd,this);var n=new e.ScreenSpaceEventHandler(this.scene.canvas);n.setInputAction(function(e){t.innerMoveEnd()},e.ScreenSpaceEventType.LEFT_UP),n.setInputAction(function(e){t.innerMoveEnd()},e.ScreenSpaceEventType.MIDDLE_UP),this.handler=n}},{key:"unbindEvent",value:function(){this.scene.camera.moveStart.removeEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd,this),this.scene.postRender.removeEventListener(this._reset,this),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"moveStartEvent",value:function(){this.mapvBaseLayer&&(this.mapvBaseLayer.animatorMovestartEvent(),this.scene.postRender.addEventListener(this._reset,this))}},{key:"moveEndEvent",value:function(){this.mapvBaseLayer&&(this.scene.postRender.removeEventListener(this._reset,this),this.mapvBaseLayer.animatorMoveendEvent(),this._reset())}},{key:"zoomStartEvent",value:function(){this._unvisiable()}},{key:"zoomEndEvent",value:function(){this._unvisiable()}},{key:"addData",value:function(t,e){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.addData(t,e)}},{key:"updateData",value:function(t,e){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.updateData(t,e)}},{key:"getData",value:function(){return this.mapvBaseLayer&&(this.dataSet=this.mapvBaseLayer.getData()),this.dataSet}},{key:"removeData",value:function(t){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer&&this.mapvBaseLayer.removeData(t)}},{key:"removeAllData",value:function(){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.clearData()}},{key:"_visiable",value:function(){return this.canvas.style.display="block",this}},{key:"_unvisiable",value:function(){return this.canvas.style.display="none",this}},{key:"_createCanvas",value:function(){var t=document.createElement("canvas");t.id=this.mapVOptions.layerid||"mapv"+zt++,t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.mapVOptions.zIndex||0,t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height;var e=this.devicePixelRatio;return"2d"==this.mapVOptions.context&&t.getContext(this.mapVOptions.context).scale(e,e),t}},{key:"_reset",value:function(){this.resizeCanvas(),this.fixPosition(),this.onResize(),this.render()}},{key:"draw",value:function(){this._reset()}},{key:"show",value:function(){this._visiable()}},{key:"hide",value:function(){this._unvisiable()}},{key:"destroy",value:function(){this.remove()}},{key:"remove",value:function(){void 0!=this.mapvBaseLayer&&(this.removeAllData(),this.mapvBaseLayer.clear(this.mapvBaseLayer.getContext()),this.mapvBaseLayer=void 0,this.canvas.parentElement.removeChild(this.canvas))}},{key:"update",value:function(t){void 0!=t&&this.updateData(t.data,t.options)}},{key:"resizeCanvas",value:function(){if(void 0!=this.canvas&&null!=this.canvas){var t=this.canvas;t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height}}},{key:"fixPosition",value:function(){}},{key:"onResize",value:function(){}},{key:"render",value:function(){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer._canvasUpdate()}}]),t}();t.CesiumMapLayer=Zt,t.MapVRenderer=Tt,t.BaseLayer=Ft,t.DataSet=r,Object.defineProperty(t,"__esModule",{value:!0})});